import time

# Function to input requests


def InputRequests():


    # Urgency Level
    running = True
    while running:
        try:
            urgencyLevel = int(input(
                "Urgency level:\n"
                "1) Low (30–60 min)\n"
                "2) Moderate (15–30 min)\n"
                "3) High (8–15 min)\n"
                "4) Severe (4–8 min)\n"
                "5) Life-Critical (0–4 min)\n"
            ))
            if 1 <= urgencyLevel <= 5:
                running = False
            else:
                print("Input not in range (1–5)")
        except:
            print("Please enter an integer")


    # CTAS Level
    running = True
    while running:
        try:
            CTAS_Level = int(input("CTAS Level (1–5): "))
            if 1 <= CTAS_Level <= 5:
                running = False
            else:
                print("Input not in range (1–5)")
        except:
            print("Please enter an integer")


    # Supply Weight
    running = True
    while running:
        try:
            supplyWeight = int(input(
                "Supply weight class:\n"
                "1) <0.5kg\n"
                "2) 0.5–2kg\n"
                "3) 2–5kg\n"
                "4) 5–15kg\n"
                "5) 15–50kg\n"
                "6) >50kg\n"
            ))
            if 1 <= supplyWeight <= 6:
                running = False
            else:
                print("Input not in range (1–6)")
        except:
            print("Please enter an integer")


    # Location
    running = True
    while running:
        try:
            locationNeeded = int(input(
                "Location:\n"
                "1) Hub\n"
                "2) ICU\n"
                "3) Maternity\n"
                "4) OR\n"
                "5) ER\n"
            ))
            if 1 <= locationNeeded <= 5:
                running = False
            else:
                print("Input not in range (1–5)")
        except:
            print("Please enter an integer")


    # Create request dictionary
    request = {
        "urgency": urgencyLevel,
        "ctas": CTAS_Level,
        "supply_weight": supplyWeight,
        "location": locationNeeded,
        "arrival_time": time.time()
    }


    return request




# Priority scoring system
def calculate_priority(request):


    # Base priority from CTAS (dominant factor)
    priority_score = request["ctas"] * 100


    # Waiting time (minutes)
    waiting_time = (time.time() - request["arrival_time"]) / 60
    priority_score -= waiting_time


    # Urgency adjustment
    priority_score -= request["urgency"] * 5


    return priority_score


# Insert request (manual insertion sort)
def insert_request(queue, new_request):


    # CTAS 1 always highest priority
    if new_request["ctas"] == 1:
        queue.insert(0, new_request)
        return


    new_priority = calculate_priority(new_request)


    for i in range(len(queue)):


        # Skip CTAS 1 already in queue
        if queue[i]["ctas"] == 1:
            continue


        if new_priority < calculate_priority(queue[i]):
            queue.insert(i, new_request)
            return


    # Lowest priority goes at the end
    queue.append(new_request)


# Drone request handling loop


def drone_receive_requests():


    delivery_queue = []


    while True:
        print("\n--- New Delivery Request ---")
        request = InputRequests()


        insert_request(delivery_queue, request)


        print("\nCurrent Drone Delivery Order:")
        for i, r in enumerate(delivery_queue, start=1):
            print(
                f"{i}. CTAS {r['ctas']} | "
                f"Urgency {r['urgency']} | "
                f"Location {r['location']} | "
                f"Priority {round(calculate_priority(r), 2)}"
            )


# Main program
if __name__ == "__main__":
    drone_receive_requests()




